<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tic-Tac-Toe with Max 3 Marks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            max-width: 320px;
            margin: 10px auto;
            aspect-ratio: 1 / 1;
        }

        .cell {
            background-color: #fff;
            border: 2px solid #dee2e6;
            font-size: 2.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
        }

        .cell.blur {
            filter: blur(1.2px);
            opacity: 0.5;
        }

        .cell.animated {
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            0%   { transform: scale(0.7); opacity: 0.5; }
            60%  { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        .cell.winner {
            background-color: #d1e7dd !important;
            color: #0f5132;
            box-shadow: 0 0 10px #198754;
        }

        .disabled {
            pointer-events: none;
        }

        #currentTurn {
            font-size: 1.2rem;
            font-weight: 500;
            margin-top: 15px;
        }

        #statusText {
            font-size: 1.25rem;
            font-weight: 500;
            margin-top: 10px;
        }

        #endNote {
            margin-top: 10px;
            font-size: 0.95rem;
            color: #6c757d;
        }

        .rules-section {
            max-width: 600px;
            margin: 40px auto;
            text-align: left;
        }

        .rules-section h4 {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .rules-section ul {
            list-style-type: disc;
            padding-left: 20px;
        }
    </style>
</head>
<body>
<div class="container text-center">
    <h2 class="mt-4">Tic-Tac-Toe (Max 3 Marks Each)</h2>

    <div id="currentTurn" class="text-primary">Current Turn: X</div>

    <div class="board" id="board"></div>
    <div id="statusText" class="text-info"></div>
    <div id="endNote"></div>
    <button class="btn btn-outline-secondary mt-3" onclick="resetGame()">Reset Game</button>

    <!-- Game Rules Section -->
    <div class="rules-section mt-5 text-start">
        <h4>Game Rules</h4>
        <ul>
            <li>The game is played on a 3Ã—3 grid.</li>
            <li>Player 1 is <strong>X</strong> and Player 2 is <strong>O</strong>. They take turns placing their mark in empty cells.</li>
            <li>The first player to get three of their marks in a horizontal, vertical, or diagonal row wins.</li>
            <li><strong>Custom Rule:</strong> Each player can have a maximum of 3 marks on the board. When a fourth mark is placed, their oldest mark is removed.</li>
            <li>The cell with a blur shows which mark will be removed next.</li>
        </ul>
    </div>
</div>

<script>
    const boardElement = document.getElementById('board');
    const statusText = document.getElementById('statusText');
    const endNote = document.getElementById('endNote');
    const currentTurnEl = document.getElementById('currentTurn');

    let board = Array(9).fill('');
    let turn = 'X';
    let gameOver = false;
    let winnerCombo = [];

    const moves = {
        'X': [],
        'O': []
    };

    const winCombos = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
    ];

    function createBoard() {
        boardElement.innerHTML = '';
        endNote.innerText = '';
        currentTurnEl.innerText = gameOver ? '' : `Current Turn: ${turn}`;

        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;

            const mark = board[i];
            cell.innerText = mark;

            if (winnerCombo.includes(i)) {
                cell.classList.add('winner');
            }

            const oldestIndex = moves[turn].length === 3 ? parseInt(moves[turn][0]) : null;
            if (mark === turn && i === oldestIndex && !winnerCombo.includes(i)) {
                cell.classList.add('blur');
            }

            if (!gameOver && mark === '') {
                cell.onclick = (e) => {
                    handleMove(e);
                    e.currentTarget.classList.add('animated');
                    setTimeout(() => e.currentTarget.classList.remove('animated'), 300);
                };
            }

            boardElement.appendChild(cell);
        }
    }

    function handleMove(event) {
        if (gameOver) return;
        const index = parseInt(event.target.dataset.index);
        if (board[index] !== '') return;

        if (moves[turn].length >= 3) {
            const oldIndex = parseInt(moves[turn].shift());
            board[oldIndex] = '';
        }

        board[index] = turn;
        moves[turn].push(index);

        const winning = checkWinner(turn);
        if (winning.length > 0) {
            winnerCombo = winning;
            gameOver = true;
            statusText.innerText = `${turn} wins! ðŸŽ‰`;
            endNote.innerText = `Winner is ${turn}. Game over!`;
            boardElement.classList.add('disabled');
            currentTurnEl.innerText = '';
        } else if (board.every(cell => cell !== '')) {
            statusText.innerText = 'It\'s a draw!';
            endNote.innerText = "It's a draw. Try again!";
            gameOver = true;
            currentTurnEl.innerText = '';
        } else {
            turn = turn === 'X' ? 'O' : 'X';
            currentTurnEl.innerText = `Current Turn: ${turn}`;
        }

        createBoard();
    }

    function checkWinner(player) {
        return winCombos.find(combo =>
            combo.every(index => board[index] === player)
        ) || [];
    }

    function resetGame() {
        board = Array(9).fill('');
        moves.X = [];
        moves.O = [];
        winnerCombo = [];
        turn = 'X';
        gameOver = false;
        boardElement.classList.remove('disabled');
        statusText.innerText = '';
        endNote.innerText = '';
        currentTurnEl.innerText = 'Current Turn: X';
        createBoard();
    }

    createBoard();
</script>
</body>
</html>
