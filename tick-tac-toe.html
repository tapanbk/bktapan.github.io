<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tic-Tac-Toe with Max 3 Marks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 8px;
            max-width: 320px;
            margin: 30px auto;
            aspect-ratio: 1 / 1;
        }

        .cell {
            background-color: #fff;
            border: 2px solid #dee2e6;
            font-size: 2.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        /* Hover effect */
        .cell:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
        }

        /* Clicked effect */
        .cell.animated {
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            0%   { transform: scale(0.7); opacity: 0.5; }
            60%  { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); }
        }

        .cell.blink {
            animation: blink 0.8s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .cell.winner {
            background-color: #d1e7dd !important;
            color: #0f5132;
            box-shadow: 0 0 10px #198754;
        }

        .disabled {
            pointer-events: none;
        }

        #statusText {
            font-size: 1.25rem;
            font-weight: 500;
            margin-top: 15px;
        }
    </style>
</head>
<body>
<div class="container text-center">
    <h2 class="mt-4">Tic-Tac-Toe (Max 3 Marks Each)</h2>
    <div class="board" id="board"></div>
    <div id="statusText" class="text-info"></div>
    <button class="btn btn-outline-secondary mt-3" onclick="resetGame()">Reset Game</button>
</div>

<script>
    const boardElement = document.getElementById('board');
    const statusText = document.getElementById('statusText');
    let board = Array(9).fill('');
    let turn = 'X';
    let gameOver = false;
    let winnerCombo = [];

    const moves = {
        'X': [],
        'O': []
    };

    const winCombos = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
    ];

    function createBoard() {
        boardElement.innerHTML = '';

        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;

            const mark = board[i];
            cell.innerText = mark;

            // Highlight winning cells
            if (winnerCombo.includes(i)) {
                cell.classList.add('winner');
            }

            // Blink oldest mark of current player
            const oldestIndex = moves[turn].length === 3 ? parseInt(moves[turn][0]) : null;
            if (mark === turn && i === oldestIndex && !winnerCombo.includes(i)) {
                cell.classList.add('blink');
            }

            // Add click listener only if cell is empty and game is active
            if (!gameOver && mark === '') {
                cell.onclick = (e) => {
                    handleMove(e);
                    e.currentTarget.classList.add('animated');
                    setTimeout(() => e.currentTarget.classList.remove('animated'), 300);
                };
            }

            boardElement.appendChild(cell);
        }
    }

    function handleMove(event) {
        if (gameOver) return;
        const index = parseInt(event.target.dataset.index);
        if (board[index] !== '') return;

        // Remove oldest mark if already 3
        if (moves[turn].length >= 3) {
            const oldIndex = parseInt(moves[turn].shift());
            board[oldIndex] = '';
        }

        // Place current move
        board[index] = turn;
        moves[turn].push(index);

        // Check for winner
        const winning = checkWinner(turn);
        if (winning.length > 0) {
            winnerCombo = winning;
            gameOver = true;
            statusText.innerText = `${turn} wins! ðŸŽ‰`;
            boardElement.classList.add('disabled');
        } else if (board.every(cell => cell !== '')) {
            statusText.innerText = 'It\'s a draw!';
            gameOver = true;
        } else {
            turn = turn === 'X' ? 'O' : 'X';
        }

        createBoard();
    }

    function checkWinner(player) {
        return winCombos.find(combo =>
            combo.every(index => board[index] === player)
        ) || [];
    }

    function resetGame() {
        board = Array(9).fill('');
        moves.X = [];
        moves.O = [];
        winnerCombo = [];
        turn = 'X';
        gameOver = false;
        boardElement.classList.remove('disabled');
        statusText.innerText = '';
        createBoard();
    }

    createBoard();
</script>
</body>
</html>
